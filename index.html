<html>
<head>
<script>
// 这个变量存放了你的仓库的API地址，你可以根据你的仓库名和用户名修改
var repoAPI = "https://api.github.com/repos/jkamkk/mp3/contents/";
// 这个变量存放了你的另一个仓库的API地址，你可以根据你的仓库名和用户名修改
var repoAPI2 = "https://api.github.com/repos/jkamkk/hmp3/contents/";

// 这个函数用来从一个URL获取JSON数据，并返回一个Promise对象
function getJSON(url) {
  return new Promise(function(resolve, reject) {
    var xhr = new XMLHttpRequest();
    xhr.open("GET", url, true);
    xhr.responseType = "json";
    xhr.onload = function() {
      if (xhr.status == 200) {
        resolve(xhr.response);
      } else {
        reject(new Error(xhr.statusText));
      }
    };
    xhr.onerror = function() {
      reject(new Error(xhr.statusText));
    };
    xhr.send();
  });
}

// 这个函数用来从仓库的API地址获取文件列表，并过滤出mp3或mp4文件的URL，返回一个数组
function getMedia(repoAPI) {
  return getJSON(repoAPI).then(function(data) {
    var media = [];
    for (var i = 0; i < data.length; i++) {
      var item = data[i];
      if (item.type == "file" && (item.name.endsWith(".mp3") || item.name.endsWith(".mp4") || item.name.endsWith(".m4a") || item.name.endsWith(".wav"))) {
        media.push(item.download_url);
      }
    }
    return media;
  });
}

// 这个函数用来从数组中随机选择一个元素并返回
function randomChoice(arr) {
  var index = Math.floor(Math.random() * arr.length);
  return arr[index];
}

// 这个函数用来重定向到一个随机的mp3或mp4文件的URL
function redirectToMedia() {
  // 使用Promise.all方法来同时获取两个仓库的mp3或mp4文件列表
  Promise.all([getMedia(repoAPI), getMedia(repoAPI2)]).then(function(results) {
    // 将两个数组合并成一个
    var media = results[0].concat(results[1]);
    // 从合并后的数组中随机选择一个元素
    var file = randomChoice(media);
    // 获取文件名和仓库名
    var fileName = file.split("/").pop();
    var repoName = file.split("/")[4];
    // 拼接成新的URL，使用 https://jkamkk.github.io/ 加上仓库名和文件名
    var newURL = "https://jkamkk.github.io/" + repoName + "/" + fileName;
    // 在页面上显示要重定向的URL，我删除了p元素和span元素，只保留了一个a元素
    var a = document.createElement("a");
    a.href = newURL;
    a.textContent = newURL;
    document.body.appendChild(a);
    // 设置一个定时器，在4秒后重定向到新的URL
    setTimeout(function() {
      window.location.href = newURL;
    }, 4000);
  }).catch(function(error) {
    console.error(error);
  });
}

// 这个函数用来在页面上添加彩带飘落的特效，我使用了一个开源的库，你可以根据你的喜好修改一些参数
function addConfetti() {
  // 创建一个script元素，引入confetti.js库的URL
  var script = document.createElement("script");
  script.src = "https://cdn.jsdelivr.net/gh/mathusummut/confetti.js/confetti.min.js";
  // 当script元素加载完成后，调用confetti.start()方法开始特效
  script.onload = function() {
    confetti.start();
  };
  // 将script元素添加到head元素中
  document.head.appendChild(script);
}
</script>
</head>
<body onload="redirectToMedia(); addConfetti();"> <!-- 我修改了body元素的onload属性，让它同时调用redirectToMedia()和addConfetti()两个函数 -->
</body>
</html>
